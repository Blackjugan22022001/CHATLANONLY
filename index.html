-- Tabel untuk menyimpan pesan
CREATE TABLE messages (
    id BIGSERIAL PRIMARY KEY,
    type TEXT NOT NULL CHECK (type IN ('text', 'file')),
    text TEXT,
    file_name TEXT,
    file_type TEXT,
    file_data TEXT,
    user_id TEXT NOT NULL,
    username TEXT NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Tabel untuk melacak pengguna online
CREATE TABLE online_users (
    id TEXT PRIMARY KEY,
    username TEXT NOT NULL,
    color TEXT NOT NULL,
    last_seen TIMESTAMPTZ DEFAULT NOW(),
    is_online BOOLEAN DEFAULT true
);

-- Enable realtime untuk kedua tabel
ALTER PUBLICATION supabase_realtime ADD TABLE messages;
ALTER PUBLICATION supabase_realtime ADD TABLE online_users;

-- Buat index untuk performa
CREATE INDEX idx_messages_created_at ON messages(created_at);
CREATE INDEX idx_online_users_last_seen ON online_users(last_seen);
